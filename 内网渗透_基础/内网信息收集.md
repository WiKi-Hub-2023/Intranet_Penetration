# 内网信息收集

## Windows

### **收集本机信息**

当渗透测试人员成功控制一台机器后，其内网结构如何、这台机器是什么角色的、使用机器的人是什么角色的、机器上安装的是什么杀毒软件、机器是通过什么方式上网的、机器是笔记本还是台式机等，都需要通过信息收集来获取。

本机信息包括主机的系统、权限、内网分配P地址段、安装的软件杀毒、端口、服务、补丁更新频率、网络连接信息、共享、会话等。如果是域内主机，系统、软件、补丁、服务、杀毒一般都是批量安装的。通过收集本机的相关信息，可以进一步了解整个域的操作系统版本、软件、补丁、用户命名方式等。

| 命令                                                         | 功能                             |
| :----------------------------------------------------------- | :------------------------------- |
| `ipconfig /all`                                              | 查询网络配置信息                 |
| systeminfo \| findstr /B /C:"OS 名称" /C:"OS 版本"           | 查询操作系统版本-中文            |
| systeminfo \| findstr /B /C:"OS Name" /C:"OS Version"        | 查询操作系统版本-英文            |
| echo %PROCESSOR_ARCHITECTURE%                                | 查看系统体系结构                 |
| wmic product get name,version                                | 安装软件版本信息                 |
| powershell "Get-WmiObject -class Win32_Product \| Select-Object -Property name,version" | 收集软件版本信息                 |
| wmic service list brief                                      | 查询本机服务信息                 |
| `tasklist /svc`                                              | 查询进程列表信息                 |
| wmic startup get command,caption                             | 查看启动程序信息                 |
| schtasks /query /fo  LIST /v                                 | 查看计划任务信息                 |
| net statistics workstation                                   | 查看主机开机时间                 |
| net user                                                     | 查询用户列表信息                 |
| net localgroup administrators                                | 获取本地管理员（通常含有域用户） |
| query user \|\| qwinsta                                      | 查看当前在线用户信息             |
| net session                                                  | 查客户端会话信息(管理员权限)     |
| `netstat -ano`                                               | 查询端口列表信息                 |
| `Systeminfo`                                                 | 查询补丁列表信息                 |
| wmic qfe get Caption,Description,HotFixID,InstalledOn        | wmic来识别安装在系统中的补丁     |
| `net share`                                                  | 查看本机共享信息                 |





